<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>李白研究数据处理流程</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.4.0/dist/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/atom-one-dark.min.css">
    <style>
        .process-card {
            background: rgba(255,255,255,0.98);
            border-radius: 12px;
            margin: 25px 0;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .mermaid-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .code-sample {
            background: #2d2d2d;
            color: #ccc;
            border-radius: 8px;
            padding: 15px;
            overflow-x: auto;
        }
        .step-badge {
            font-size: 0.8em;
            padding: 5px 10px;
            margin-right: 10px;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <h1 class="display-5 fw-bold mb-5 text-center">李白研究数据处理流程</h1>

        <!-- 总体流程 -->
        <div class="process-card">
            <h3>总体处理流程</h3>
            <div class="mermaid-container">
                <div class="mermaid">
graph TD
    A[原始文本] --> B(数据预处理)
    B --> C{信息提取}
    C --> D[实体识别]
    C --> E[关系抽取]
    C --> F[事件提取]
    D --> G[知识图谱构建]
    E --> G
    F --> G
    G --> H[可视化分析]
                </div>
            </div>
        </div>

        <!-- 数据预处理 -->
        <div class="process-card">
            <h3><span class="badge bg-primary step-badge">Step 1</span>数据预处理</h3>
            <div class="mermaid-container">
                <div class="mermaid">
flowchart LR
    A[原始文本] --> B(文本清洗)
    B --> C(分句处理)
    C --> D(时间标准化)
    D --> E(地理位置标注)
                </div>
            </div>
            <pre class="code-sample"><code class="language-python">
# 示例：时间标准化处理
import re

def normalize_time(text):
    patterns = [
        (r'开元(\d+)年', '开元\g<1>年（公元\g<1>+712年）'),
        (r'天宝初', '天宝元年（742年）')
    ]
    for pattern, replacement in patterns:
        text = re.sub(pattern, replacement, text)
    return text
            </code></pre>
            <div class="alert alert-success">
                <strong>处理要点：</strong>
                <ul>
                    <li>去除现代注释和编者按语</li>
                    <li>统一古今地名（如"金陵"→"南京"）</li>
                    <li>将农历日期转换为公元纪年</li>
                </ul>
            </div>
        </div>

        <!-- 信息提取 -->
        <div class="process-card">
            <h3><span class="badge bg-success step-badge">Step 2</span>信息提取</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>实体识别模型</h5>
                    <pre class="code-sample"><code class="language-json">
{
  "text": "天宝元年李白在长安结识杜甫",
  "entities": [
    {"text": "天宝元年", "type": "TIME"},
    {"text": "李白", "type": "PERSON"},
    {"text": "长安", "type": "LOC"},
    {"text": "杜甫", "type": "PERSON"}
  ]
}
                    </code></pre>
                </div>
                <div class="col-md-6">
                    <h5>关系抽取示例</h5>
                    <pre class="code-sample"><code class="language-python">
# 使用prompt工程进行关系抽取
prompt = """
文本：公元744年，李白与杜甫在洛阳相会
请提取：
- 人物关系：[李白, 杜甫, 结识]
- 时间：744年
- 地点：洛阳
"""
response = llm.generate(prompt)
                    </code></pre>
                </div>
            </div>
        </div>

        <!-- 知识图谱构建 -->
        <div class="process-card">
            <h3><span class="badge bg-warning step-badge">Step 3</span>知识图谱构建</h3>
                <div class="row">
                    <div class="col-md-6">
                        <h5>实体识别模型</h5>
                        <pre class="code-sample"><code class="language-json">
                            erDiagram
                            PERSON ||--o{ POEM : "创作"
                            PERSON ||--|{ EVENT : "参与"
                            PERSON ||--o{ LOCATION : "到访"
                            EVENT ||--|{ LOCATION : "发生地"
                            POEM ||--|{ THEME : "主题"
                        
                            PERSON {
                                姓名 STRING
                                生卒年 DATETIME
                            }
                            POEM {
                                诗名 STRING
                                创作年份 INT
                                名句 TEXT
                            }
                            EVENT {
                                事件名称 STRING
                                发生时间 DATETIME
                            }
                            LOCATION {
                                地名 STRING
                                经纬度 STRING
                            }
                            THEME {
                                主题 STRING
                            }
                        </code></pre>
                    </div>            
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
            <pre class="code-sample"><code class="language-cypher">
// 创建李白节点
CREATE (lb:人物 {
  姓名: '李白',
  生卒年: '701-762',
  称号: ['诗仙', '青莲居士']
})

// 创建关系
MATCH (lb:人物 {姓名:'李白'}), (df:人物 {姓名:'杜甫'})
CREATE (lb)-[:结识 {
  时间: 744,
  地点: '洛阳',
  事件: '首次会面'
}]->(df)
            </code></pre>
            </div>
        </div>

        <!-- 可视化分析 -->
        <div class="process-card">
            <h3><span class="badge bg-danger step-badge">Step 4</span>可视化分析</h3>
            <div class="mermaid-container">
                <div class="mermaid">
gantt
    title 李白人生轨迹时间轴
    dateFormat  YYYY
    section 重要事件
    出生           :a1, 0701, 1d
    入长安          :a2, 0742, 1d
    创作将进酒       :a3, 0752, 3d
    流放夜郎        :a4, 0758, 2d
    逝世           :a5, 0762, 1d
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <h5>地理轨迹可视化</h5>
                    <pre class="code-sample"><code class="language-json">
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {"type": "Point","coordinates": [116.4, 39.9]},
      "properties": {"name": "长安","time": 742-744}
    },
    {
      "type": "Feature",
      "geometry": {"type": "Point","coordinates": [114.3, 30.5]},
      "properties": {"name": "江夏","time": 758}
    }
  ]
}
                    </code></pre>
                </div>
                <div class="col-md-6">
                    <h5>社交网络示例</h5>
                    <img src="/kg/li_bai.jpg" 
                         class="img-fluid" 
                         alt="李白社交网络图">
                </div>
            </div>
        </div>

        <!-- 注意事项 -->
        <div class="process-card">
            <h3>⚠️ 注意事项</h3>
            <div class="alert alert-warning">
                <ul>
                    <li>处理古文时注意通假字识别（如"说"→"悦"）</li>
                    <li>区分创作时间与事件时间</li>
                    <li>处理历史地名与现代地理的对应关系</li>
                    <li>注意同一人物的不同称谓（如李太白、青莲居士）</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            gantt: { 
                axisFormat: '%Y',
                topAxis: true
            }
        });

        hljs.registerLanguage('cypher', function(hljs) {
            return {
                keywords: 'MATCH CREATE RETURN WHERE WITH SET',
                contains: [
                    hljs.HASH_COMMENT_MODE,
                    hljs.QUOTE_STRING_MODE,
                    hljs.NUMBER_MODE,
                    {className: 'keyword', begin: /:\w+/}
                ]
            };
        });
        hljs.highlightAll();
    </script>
</body>
</html>